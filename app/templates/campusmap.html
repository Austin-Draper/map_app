{% extends "base.html" %}

{% block map %}
    <div id="info" class="ui label"></div>
    <!-- <div id="warning"></div> -->
    {% block display %}{% endblock %}
    <div id="map"></div>
    </div>

	<script>
    var latlong;
    var map;
    var GeoMarker;
    var directionsDisplay;
    var directionsService;
    var markers = []

    initMap();

    if (navigator.geolocation) { // Call geolocation to get user's current position
        navigator.geolocation.getCurrentPosition(getCurrPos, errorCallback, {
            enableHighAccuracy: true
        });
    }

    function getCurrPos(position) {
        document.getElementById('location').value = position.coords.latitude + "," + position.coords.longitude;
        //alert(document.getElementById('location').value);
    }

    function errorCallback() {}
    var markerButtons = document.getElementsByClassName('ui button marker');
    for (let i = 0; i < markerButtons.length; i++) {
        var button = markerButtons[i];
                var latlng = button.value.split(',');
                var lat = parseFloat(latlng[0]);
                var lng = parseFloat(latlng[1]);
                var marker = new google.maps.Marker({
                        position: new google.maps.LatLng(lat, lng),
                });
                markers.push(marker);
                marker.setMap(map);
                marker.setVisible(false);
                button.addEventListener('click', function() {    
                if (this.value != "ON") {
                    markers[i].setVisible(true);
                    this.value="ON";
                }
                else {
                    markers[i].setVisible(false);
                    this.value="OFF";
                }
            })
    }
    var dirButtons = document.getElementsByClassName('ui positive button');
    for(let i = 0; i < dirButtons.length; i++) {
        var button = dirButtons[i];
        if (button.className === 'ui positive button') {
            button.addEventListener('click', function() {
                document.getElementById('src1').value = this.id;
            });
        }
    }

    function startTime() { // Displays real time clock
        var today = new Date();
        var h = today.getHours();
        if (h > 12) {
            h = h - 12;
        } else if (h == 0) {
            h = 12;
        }
        var m = today.getMinutes();
        var s = today.getSeconds();
        h = checkTime(h);
        m = checkTime(m);
        s = checkTime(s);
        document.getElementById('info').innerHTML = h + ":" + m + ":" + s;
        setTimeout(startTime, 500); {% block time %} {% endblock %}
    }

    function checkTime(i) {
        if (i < 10) {
            i = "0" + i;
        }
        return i;
    }

    function initMap() { // displays map on page, sets up variables for the directions service for use later
        startTime();
        var csufLocation = {
            lat: 33.881994,
            lng: -117.885076
        };
        directionsDisplay = new google.maps.DirectionsRenderer;
        directionsService = new google.maps.DirectionsService;
        var mapOptions = {
            zoom: 17,
            center: csufLocation,
            streetViewControl: false,
            mapTypeControl: false,
            styles: [{
                    "featureType": "landscape",
                    "stylers": [{
                            "hue": "#FFA800"
                        },
                        {
                            "saturation": 0
                        },
                        {
                            "lightness": 0
                        },
                        {
                            "gamma": 1
                        }
                    ]
                },
                {
                    "featureType": "road.highway",
                    "stylers": [{
                            "hue": "#53FF00"
                        },
                        {
                            "saturation": 100
                        },
                        {
                            "lightness": 40
                        },
                        {
                            "gamma": 1
                        }
                    ]
                },
                {
                    "featureType": "road.arterial",
                    "stylers": [{
                            "hue": "#FBFF00"
                        },
                        {
                            "saturation": 0
                        },
                        {
                            "lightness": 0
                        },
                        {
                            "gamma": 1
                        }
                    ]
                },
                {
                    "featureType": "road.local",
                    "elementType": "geometry",
                    "stylers": [{
                            "hue": "#FFFFFF"
                        },
                        {
                            "saturation": 100
                        },
                        {
                            "lightness": 100
                        },
                        {
                            "gamma": 1
                        }
                    ]
                },
                {
                    "featureType": "water",
                    "stylers": [{
                            "hue": "#00BFFF"
                        },
                        {
                            "saturation": 6
                        },
                        {
                            "lightness": 8
                        },
                        {
                            "gamma": 1
                        }
                    ]
                },
                {
                    "featureType": "poi",
                    "stylers": [{
                            "hue": "#679714"
                        },
                        {
                            "saturation": 33.4
                        },
                        {
                            "lightness": -25.4
                        },
                        {
                            "gamma": 1
                        }
                    ]
                }
            ]
        };
        map = new google.maps.Map(document.getElementById('map'), mapOptions);
        directionsDisplay.setMap(map);

        {% block maproute %} {% endblock %}
    }
    document.getElementById('src1').value = "";
</script>

{% endblock %}
