{% extends "base.html" %}

{% block map %}
    <!-- <div id="warning"></div> -->
    {% block display %} {% endblock %}
    <div id="map"></div>
{% endblock %}
    
{% block mapscript %}
	<script>
    var latlong;
    var map;
    var GeoMarker;
    var directionsDisplay;
    var directionsService;
    var markers = []
    var markerButtons = document.getElementsByClassName('ui button marker');
    var dirButtons = document.getElementsByClassName('ui button positive');
    const csufLocation = {
            lat: 33.881994,
            lng: -117.885076
    };

    initMap();

    if (navigator.geolocation) { // Call geolocation to get user's current position
        navigator.geolocation.getCurrentPosition(getCurrPos, errorCallback, {
            enableHighAccuracy: true,
        });
    }

    function getCurrPos(position) {
        curLoc = position.coords.latitude + "," + position.coords.longitude;
        document.getElementById('location').value = curLoc;
        document.getElementById('CurrentLocation') = curLoc;
        //alert(document.getElementById('location').value);
    }

    function errorCallback() {}

    for (let i = 0; i < markerButtons.length; i++) {
        var button = markerButtons[i];
        var latlng = button.value.split(',');
        var lat = parseFloat(latlng[0]);
        var lng = parseFloat(latlng[1]);
        var marker = new google.maps.Marker({
                position: new google.maps.LatLng(lat, lng),
        });
        markers.push(marker);
        marker.setMap(map);
        marker.setVisible(false);
        button.addEventListener('click', function() {    
            if (this.value != "ON") {
                markers[i].setVisible(true);
                this.value="ON";
            }
            else {
                markers[i].setVisible(false);
                this.value="OFF";
            }
        })
    }

    for (let i = 0; i < dirButtons.length; i++) {
        var button = dirButtons[i];
        if (button.className === 'ui positive button') {
            button.addEventListener('click', function() {
                document.getElementById('src1').value = this.id;
            });
        }
    }

    function initMap() { // displays map on page, sets up variables for the directions service for use later
        directionsDisplay = new google.maps.DirectionsRenderer;
        directionsService = new google.maps.DirectionsService;
        var mapOptions = {
            zoom: 17,
            center: csufLocation,
            streetViewControl: false,
            mapTypeControl: false,
            gestureHandling: 'greedy',
            styles: [{
                    "featureType": "landscape",
                    "stylers": [{
                            "hue": "#FFA800"
                        },
                        {
                            "saturation": 0
                        },
                        {
                            "lightness": 0
                        },
                        {
                            "gamma": 1
                        }
                    ]
                },
                {
                    "featureType": "road.highway",
                    "stylers": [{
                            "hue": "#53FF00"
                        },
                        {
                            "saturation": 100
                        },
                        {
                            "lightness": 40
                        },
                        {
                            "gamma": 1
                        }
                    ]
                },
                {
                    "featureType": "road.arterial",
                    "stylers": [{
                            "hue": "#FBFF00"
                        },
                        {
                            "saturation": 0
                        },
                        {
                            "lightness": 0
                        },
                        {
                            "gamma": 1
                        }
                    ]
                },
                {
                    "featureType": "road.local",
                    "elementType": "geometry",
                    "stylers": [{
                            "hue": "#FFFFFF"
                        },
                        {
                            "saturation": 100
                        },
                        {
                            "lightness": 100
                        },
                        {
                            "gamma": 1
                        }
                    ]
                },
                {
                    "featureType": "water",
                    "stylers": [{
                            "hue": "#00BFFF"
                        },
                        {
                            "saturation": 6
                        },
                        {
                            "lightness": 8
                        },
                        {
                            "gamma": 1
                        }
                    ]
                },
                {
                    "featureType": "poi",
                    "stylers": [{
                            "hue": "#679714"
                        },
                        {
                            "saturation": 33.4
                        },
                        {
                            "lightness": -25.4
                        },
                        {
                            "gamma": 1
                        }
                    ]
                }
            ]
        };
        map = new google.maps.Map(document.getElementById('map'), mapOptions);
        directionsDisplay.setMap(map);

        {% block maproute %} {% endblock %}
    }
    document.getElementById('src1').value = "";
</script>
{% endblock %}
